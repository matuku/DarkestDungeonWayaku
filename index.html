<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
			<title>DD</title>
			<style>
			body {
				font-family: "游ゴシック", "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", "Meiryo", sans-serif;
			}
			</style>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
			<script src="./lib/convertXml.js"></script>
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
				integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
				integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
			<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
				integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
			<script>
			var fs = require('fs');
			var exec = require('child_process').exec;

			$(document).ready(function(){

				$('#mainTabs a').click(function (e) {
					e.preventDefault();
					$(this).tab('show');
					$(".tabCtl").hide();
					var target = $(this).attr('href');
					// alert(target);
					$(target).show();
				})

			});

			var cbUpdateCheck = function(str){
				$("#updCheck").html(str);
			}

			checkUpdate(cbUpdateCheck);

			// function dispLog(msg){
			// 	// console.log(msg);
			// 	var tmpLog = $(".log").html();
			// 	$(".log").html(msg + "<br>" + tmpLog);
			// }

			function dispAlert(msg) {
				if(msg != ""){
					$("#alertDiv").show();
					$("#alertMsg").text(msg);					
				}else{
					$("#alertDiv").hide();
					$("#alertMsg").text("");					
				}
			}

			function execXmlConv(){

				var steamFolder = $("#steamDir").val();
				steamFolder = steamFolder.replace(/\\/g,'/');
				if(steamFolder == ""){
					dispAlert("DarkestDungeon インストールフォルダを指定してください");
					return;
				}else{
					dispAlert("");
				}
				var resultFolder = $("#resultDir").val();
				resultFolder = resultFolder.replace(/\\/g,'/');
				if(resultFolder == ""){
					dispAlert("XMLファイル出力フォルダを指定してください");
					return;	
				}else{
					dispAlert("");
				}

				getGssData("対応表",setData);
				getGssData("curios.string_table",setData);
				getGssData("actor.string_table",setData);
				getGssData("activity_log.string_table",setData);
				getGssData("dialogue.string_table",setData);
				getGssData("help.string_table",setData);
				getGssData("quirks.string_table",setData);
				getGssData("heroes.string_table",setData);
				getGssData("menu.string_table",setData);
				getGssData("miscellaneous.string_table",setData);

				replaceXml("curios.string_table",dataArray["curios.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("actor.string_table",dataArray["actor.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("activity_log.string_table",dataArray["activity_log.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("dialogue.string_table",dataArray["dialogue.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("help.string_table",dataArray["help.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("quirks.string_table",dataArray["quirks.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("heroes.string_table",dataArray["heroes.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("menu.string_table",dataArray["menu.string_table"],dataArray["対応表"],steamFolder,resultFolder);
				replaceXml("miscellaneous.string_table",dataArray["miscellaneous.string_table"],dataArray["対応表"],steamFolder,resultFolder);
			 }

			function execFontConv(orgFontFileName){
				exec('ttx -t cmap '+ orgFontFileName, function(err, stdoutTxt, stderrTxt){
					dispLog('ttx -t cmap '+ orgFontFileName);
					dispLog(stdoutTxt+stderrTxt);
					var orgTtxName = orgFontFileName.replace(/\.ttf/i, '.ttx');
					var newTtxName = replaceCmap(orgTtxName);
					exec('ttx -m '+ orgFontFileName + ' ' + newTtxName, function(err, stdoutTxt, stderrTxt){
						dispLog('ttx -m '+ orgFontFileName + ' ' + newTtxName);
						dispLog(stdoutTxt+stderrTxt);
					});
				});
			}

			</script>
	</head>

<body>
	<div class="container">
	
		<div class="header clearfix">
			<nav>
			<ul class="nav nav-pills pull-right">
				<li role="presentation"><a href="#" id="updCheck"></a></li>
				<li role="presentation"><a href="https://github.com/matuku/test/issues"><i class="fa fa-bug">
					</i></a>
				</li>
				<li role="presentation"><a href="https://twitter.com/matuku7"><i class="fa fa-twitter">
					</i>Twiiter</a>
				</li>
				<li role="presentation"><a href="https://github.com/matuku"><i class="fa fa-github">
					</i>GitHub</a>
				</li>
			</ul>
			</nav>
			<h3 class="text-muted">DarkestDungeon 和訳 tool</h3>
		</div>
		<div class="header clearfix">
			<ul class="nav nav-tabs" id="mainTabs">
				<li role="presentation" class="active"><a href="#localization">localization</a></li>
				<li role="presentation"><a href="#fonts">fonts</a></li>
			</ul>
		</div>
	 <div class="row tabCtl" id="localization">
		<div class="col-md-4">
			<BR>
			<div class="panel panel-default">
				<div class="panel-heading">
					<span class="glyphicon glyphicon-asterisk" aria-hidden="true"></span>
						Setting
				</div>
				<div class="panel-body">
					<div class="form-group">
						<p class="help-block">
							<i class="fa fa-steam-square"></i>
							DarkestDungeon インストールフォルダを指定
						</p>
						<input type="file" id="steamDir" webkitdirectory directory />
					</div>
					<div class="form-group">
						<p class="help-block">
							<i class="fa fa-download"></i>
							XMLファイル出力フォルダを指定
						</p>
						<input type="file" id="resultDir" webkitdirectory directory />
					</div>
				</div>
			</div>

			<div class="alert alert-danger" role="alert" id="alertDiv" style="display:none">
				<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
				<span class="sr-only">Error:</span>
				<span id="alertMsg"></span>
			</div>

			<div class="panel panel-default">
				<div class="panel-body">
					<div class="form-group">
						<p class="help-block">
							<button class="btn btn-primary" onclick="execXmlConv();" id="btnXmlConv">
								変換
							</button>
						</p>
					</div>
				</div>
			</div>

		</div>
		<div class="col-md-8">		
			<BR>
			<div class="panel panel-default">
				<div class="panel-heading">
					<span class="glyphicon glyphicon-scale" aria-hidden="true"></span>
						progress
				</div>
				<div class="panel-body" style="height:350px;overflow-y:scroll;">
					<h4>actor.string_table</h4>
					<div class="progress">
						<div id="actor" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
							<span class="sr-only"></span>
						</div>
					</div>
					<h4>curios</h4>
					<div class="progress">
						<div id="curios" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>activity_log</h4>
					<div class="progress">
						<div id="activity_log" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>dialogue</h4>
					<div class="progress">
						<div id="dialogue" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>help</h4>
					<div class="progress">
						<div id="help" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>quirks</h4>
					<div class="progress">
						<div id="quirks" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>heroes</h4>
					<div class="progress">
						<div id="heroes" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>menu</h4>
					<div class="progress">
						<div id="menu" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
					<h4>miscellaneous</h4>
					<div class="progress">
						<div id="miscellaneous" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span class="sr-only"></span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row tabCtl" id="fonts" style="display:none">
		<br>	
		<div class="jumbotron">
		<h2>It is in development.</h2>
		</div>
		</div>
	</div>
</body>
</html>
